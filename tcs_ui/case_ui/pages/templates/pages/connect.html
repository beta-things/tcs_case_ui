{% load static %}

<!DOCTYPE html>
<html>

<head>
	<title>Connect</title>

	<style>

		body{
			background-color: black;
		}
		/* Define a new font family called Roboto */
		@font-face {
			font-family: 'Roboto';
			src: url('{% static "fonts/Roboto/Roboto-Light.ttf" %}') format('truetype');
		}

		/* Apply the Roboto font family to the body text */
		.container{
			font-family: 'Roboto' !important;
			font-weight: 400;
		
		}



	</style>

	
	
	<!-- Link to the Bootstrap CSS file -->
	<link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">

	<link rel="stylesheet" href="{% static 'css/styles.css' %}">

	<!-- Link to jQuery (required for Bootstrap JS) -->
	<script src="{% static 'js/jquery-3.6.4.min.js' %}"></script>

	<!-- Link to the Bootstrap JS file -->
	<script src="{% static 'js/bootstrap.min.js' %}"></script>

	<script src="{% static 'js/vue.global.js' %}"></script>

    <script src="{% static 'js/axios.min.js' %}"></script>

	
	

	
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
 
</head>
<body>
    <div id="main_content" class="container">
        <div class="row mb-3 mt-3">
            <div class="col-sm-6 flecks-center"><h1>List of Available Devices</h1></div>
            <div class="col-sm-3">
                <div class="text-center info-box sm-text" @click="goToHome" id="goHome" >
					Back
				</div>
            </div>
            <div class="col-sm-3">
                <div class="text-center info-box sm-text" @click="reloadPage" id="reload">
					Refresh
				</div>
            </div>
        </div>
            
        <div class="row boarder-box">
            <div class="col-md-12 ">
                {% for system in systems %}
                    <div class="row each-item mt-2 mb-2" >
                        <div class="col-sm-6"><h3>{{system.host_name}}</h3></div>
                        <div class="col-sm-6 text-center"><h2 >{{system.ip}}</h2></div>
                        <div class="col-sm-7 center-text"><h5 >{{system.version}}</h5></div>
                        <div class="col-sm-2 mb-2"><button class="btn btn-success list-button" @click="testIP('{{system.ip }}', {{forloop.counter}} )">Test</button></div>
                        <div class="col-sm-3"><h2 id="{{forloop.counter}}"></h2></div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>

</body>

<script>
	const { createApp } = Vue

	createApp({
		data() {
			return {
				showQRArea:false,
				lastActivity: Date.now(),
                pingTimes:[]
			}
		},
		beforeMount(){
			$('body').hide();
		},
		mounted(){
			setInterval(() => {
				if (Date.now() - this.lastActivity > 90000) {
        			this.redirectToSleepPage();
      			}
    		}, 1000);
			$('body').fadeIn(1000);
		},
		methods:{
			togleQRAreas(){
				this.showQRArea = !this.showQRArea;
				this.refreshActivity();
			},
			reloadPage(){
				
				$('#reload').css('background-color', 'rgb(141, 140, 140)');
				$('body').fadeOut(500,function() {
					location.reload();
				});
			},
			goToHome(){
				$('#goHome').css('background-color', 'rgb(141, 140, 140)');
				$('body').fadeOut(500,function() {
					window.location.href = '/';	
				});
			},
			refreshActivity() {
				this.lastActivity = Date.now();
			},
			redirectToSleepPage() {
				$('body').fadeOut(500,function() {
					window.location.href = '/sleep';	
				});
				
			},
            async testIP(ip,retrunPosition){
                console.log(ip);
                const response = await axios.get('/check/', {
					params: {
                    	ip_address: ip,
					}
                });
                $('#'+retrunPosition).text(response.data.message+" ms");
               
                console.log(response.data.message);
            }
		}
	}).mount('#main_content')
</script>

</html>
